---
- name: setup secrets
  hosts: atomichosts

  vars_files:
    - vault.yml
    - vars.yml

  tasks:
   - name: make sure directories exist
     file:
       path: "{{ item }}"
       state: directory
       owner: root
       group: root
       mode: 0755
     with_items:
       - /var/kubernetes
       - /var/kubernetes/secrets

   - name: template out secret files
     template:
       src: templates/secrets.j2
       dest: /var/kubernetes/secrets/{{ item }}.yml
       mode: 0600
     with_items: "{{ secrets }}"
     tags: [ secrets ]
